<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Tiffany's Lab 11</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Bootstrap Icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />
        <!-- SimpleLightbox plugin CSS-->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <link rel=stylesheet href="bootstrap.min.css">
        <style>
        body {
          background-image: url('../assets/img/Grid_paper.webp');
          background-repeat: no-repeat;
          background-attachment: fixed; 
          background-size: cover;
        }
        </style>
    </head>
    <body id="page-top">
          
        <!-- About-->
        <section class="page-section bg-warning" id="about">
            <p style="background-image: url('../assets/img/Grid_paper.webp');">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-lg-8 text-center">
                        <h2> Lab 11: Localization on the Real Robot </h2>
                        <hr class="divider divider-light" />
                        <p> In this lab, I will bring the simulation from Lab 10 to life by performing
                        grid localization using Bayes filter on data from my real robot. I will place the robot at different points around the map
                        and see how well it can localize its location using odometry and time of flight sensor data. </p>
                        
                        <div class="list-group">
                          <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
                            <div class="d-flex w-100 justify-content-between">
                              <h5 class="mb-1">Test New Localization Simulation</h5>
                            </div>
                            <p class="mb-1">In Lab 10, we wrote the localization code by ourself to learn the processes, filters, and models used
                            to localize a mobile robot. In the current lab, we are provided with an optimized implementation which we will modify
                            to drive our physical robot. The optimized code utilizes precaching, vector processing, and other programming practices
                            which significantly speed up the calculation time. To test this code out, I ran the simulation once again and made sure
                            it yielded the expected results. Below is the output of the simulation, where The green line shows the robot's actual ground 
                            truth position, the red line is estimation based on odometry/sensor values, and the blue line is the Bayes filter estimation of the position. 
                            </p>    
                              <img src="assets/img/simulation_lab11.png" alt="Simulation" width=90% height=auto/>
                        </a>
                    </div>
                        <br>
                        <div class="list-group">
                          <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
                            <div class="d-flex w-100 justify-content-between">
                              <h5 class="mb-1">Code Implementation</h5>
                            </div>
                              <p class="mb-1">Before we can run the simulation code on the real robot, we have to implement the <code> perform_observation_loop() </code> 
                                  function of class RealRobot in lab11_real.ipynb. This code allows the robot to rotate at a uniform angular speed of 15 degrees
                                  per second and collect 18 evenly spaced time of flight sensor readings each 20 degrees apart. This array of 18 data points 
                                  is then passed into the optimized localization program to provide the final estimation of the robot's location. Here is the code
                                  I used to implement this functionality:
                            </p>   
                               <script src="https://gist.github.com/tiffanyguo8/e48696610f5718a8a0268bb5567e2ebe.js"></script>
                        </a>    
                        </div>       
                            <br>
                        <div class="list-group">
                          <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
                            <div class="d-flex w-100 justify-content-between">
                              <h5 class="mb-1">Localization</h5>
                            </div>
                            <p class="mb-1">Using the new localization code, I placed my robot at the various marked poses in the lab and ran the routine
                                to take 18 sensor measurements and predict the robot's location. The results for each location are as follows:
                            </p>
                              <p> (0,0) <br>
                              <img src="assets/img/lab11/localization_00_green.png" alt="Localization" width=49% height=auto/>
                              <img src="assets/img/lab11/localization_00_blue.png" alt="Localization" width=49% height=auto/>
                                  <br>
                              Although this pose is not one of the 4 included in the lab, my localization result matched perfectly with the ground truth,
                                  so I had to include it :)
                              </p>
                              <p> (-3,-2) and (0,3) <br>
                              <img src="assets/img/lab11/localization_-3-2.png" alt="Localization" width=49% height=auto/>
                              <img src="assets/img/lab11/localization_03.png" alt="Localization" width=49% height=auto/>
                                  <br>
                              I was also able to get pretty good results for the above two points after many tries. The green dot represents the ground truth position,
                                  and the blue dot is the localization result. 
                              </p>
                              <p> (5,3) <br>
                              <img src="assets/img/lab11/localization_53.png" alt="Localization" width=49% height=auto/>
                              <img src="assets/img/lab11/localization_53_2.png" alt="Localization" width=49% height=auto/>
                                  <br>
                              This point was harder to localize, and I was able to get mixed results after many tries. However, there were many runs
                                  where I successfully collected and constructed a polar plot of the 18 sensor data points just to have the localization
                                  process return a completely wrong prediction with high confidence. One change that helped the localization process to 
                                  return the correct prediction was to manually remove some data points which should be farther away but somehow recorded
                                  to be much closer to the robot due to faulty ToF sensor readings. After making these points appear farther away as expectd,
                                  the localization performed better. 
                              </p>
                              <p> (5,-3) <br>
                              <img src="assets/img/lab11/localization_5-3.png" alt="Localization" width=49% height=auto/>
                                  <br>
                              Lastly, it was very difficult for me to localize this point. After many attempts, the localization process kept mistaking
                                  (5,-3) for a similar point farther to the left. Since both points have a wall to the right and bottom sides and are more
                                  open on the other sides, the localization process may have mistaken these two wall features. In addition, my ToF sensors
                                  are not extremely reliable and sometimes returned faulty values or sensed objects that weren't there which made it hard
                                  to accurately localize. 
                              </p>
                        </a>    
                        </div>    
                        <br>
                        <div class="list-group">
                          <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
                            <div class="d-flex w-100 justify-content-between">
                              <h5 class="mb-1">Discussion</h5>
                            </div>
                              <p class="mb-1">In summary, my robot's ability to localize is inconsistent and unreliable. Even for the poses that yielded more or less
                                  successful localization results, I had to run many trials in order to achieve sufficiently valid data. I discussed this problem
                                  with the TAs in the lab and learned that it is not uncommon for ToF sensors to make unreliable measurements, especially at
                                  longer distances. I had the same problem in the stunt lab where my robot would often detect a wall without there being one
                                  in front of the robot, and it would prematurely stop and attempt the stunt when it was actually very far from the wall. This issue seemed
                                  to happen again in this lab, and since there are only 18 data points used in the localization process, even one faulty data point
                                  can cause the prediction to be erraneous. This is in contrast to the mapping lab, where I was able to achieve very accurate results
                                  with my ToF sensor despite its occasional flawed data readings due to the sheer volume of data I was collecting. In conclusion, 
                                  due to difficulty with my ToF sensors and getting accurate sensor readings, my robot was unable to consistently localize correctly. Therefore,
                                  I do not plan to use localization in Lab 12, as I am afraid it will not yield consistent and accurate results. 
                            </p>   
                        </a>    
                        </div>     
                        <br>
                        <div class="d-grid gap-2">
                           <a class="btn btn-lg btn-primary" href="index.html">Home</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
            
        <!-- Footer-->
        <footer class="bg-light py-5">
            <div class="container px-4 px-lg-5"><div class="small text-center text-muted">Copyright &copy; 2023 - Tiffany &Co</div></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- SimpleLightbox plugin JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    </body>
</html>
